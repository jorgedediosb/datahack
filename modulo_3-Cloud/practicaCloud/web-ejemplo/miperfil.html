<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallaserverless - Mi Perfil</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Encabezado -->
    <header>
        <!-- Logo y navegación -->
        <div class="logo">
            <a href="index.html">
                <img src="images/wallapop-logo.png" alt="Wallapop Datahack">
            </a>
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Inicio</a></li>
                <li><a href="miperfil.html">Mi perfil</a></li>
                <li><a href="cierresesion.html">Cerrar Sesión</a></li>
            </ul>
        </nav>
    </header>

    <!-- Contenido principal -->
    <main>
        <!-- Sección Anuncios -->
        <section class="anuncio" id="misAnuncios">
            <h2>Mis anuncios</h2>
            <div class="anuncio" id="nohayanuncios">
                <p>Ningún anuncio publicado</p>
            </div>        
        </section>

        <!-- Sección Mensajes -->
        <section class="mensajes">
            <h2>Mis mensajes</h2>
            <!-- Aquí se cargarían los mensajes del chat mediante AJAX -->
            <div class="mensaje">
                <h4>Pepito Grillo</h4>
                <h5>Producto: Apple Macbook Air</h5>
                <p>Quiero una rebajita buena que no me llega el sueldo compadre.</p>
                <button class="boton">Responder</button>
            </div>
            <div id="chat-container">
                <!-- Aquí se cargaría la interfaz de usuario del chat -->
            </div>
        </section>

        <!-- Sección Usuario -->
        <section class="usuario">
            <!-- Información del usuario -->
            <h2>Mi Perfil</h2>
            <div class="perfil">
                <img src="images/perfil.jpg" alt="Foto perfil">
                <h3>Jorge de Dios</h3>
                <p>Email: jorge@example.com</p>
                <div class="boton">
                    <button class="boton" type="submit" id="btnCrearAnuncio">Crear anuncio</button>
                </div>
            </div>
            <!-- Formulario Nuevo Anuncio -->
            <div class="nuevo-anuncio-container" style="display: none;">
                <section>
                    <h2 style="white-space: nowrap;">Nuevo Anuncio</h2>
                    <form id="formularioAnuncio">
                        <label for="titulo">Título:</label><br>
                        <input type="text" id="titulo" name="titulo"><br>
                        <label for="descripcion">Texto mensaje:</label><br>
                        <textarea id="descripcion" name="descripcion"></textarea><br>
                        <label for="precio">Precio:</label><br>
                        <input type="text" id="precio" name="precio"><br>
                        <div class="boton">
                            <button class="boton" type="submit" id="btnPublicarAnuncio">Publicar anuncio</button>
                        </div>
                    </form>
                </section>
            </div>
            <!-- Formulario Nuevo Mensaje -->
            <div class="formulario-mensaje" style="display: none;">
                <section>
                    <h2 style="white-space: nowrap;">Nuevo Mensaje</h2>
                    <form id="formularioAnuncio">
                        <label for="mensaje">Mensaje:</label><br>
                        <textarea id="mensaje" name="mensaje"></textarea><br>
                        <div class="boton">
                            <button class="boton" type="submit" id="btnEnviarMensaje">Enviar</button>
                        </div>
                    </form>
                </section>
            </div>
        </section>
    </main>

    <!-- Pie de página -->
    <footer>
        <!-- Información del pie de página -->
        <p>&copy; 2024 Wallaserverless. Todos los derechos reservados.</p>
    </footer>

    <!-- Script para cargar anuncios en 'mi perfil' -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            // Botón "Crear anuncio" abre el formulario del nuevo anuncio
            $("#btnCrearAnuncio").click(function() {
                // Mostrar u ocultar el formulario para crear un nuevo anuncio
                $(".nuevo-anuncio-container").toggle();
            });

            // Manejar el envío del formulario para crear un nuevo anuncio
            $("#formularioAnuncio").submit(function(event) {
                event.preventDefault(); // Evitar que se recargue la página

                // Obtener los datos del formulario
                var formData = new FormData(this);

                // Crear un objeto con los datos del anuncio
                var nuevoAnuncio = {
                    title: formData.get('titulo'),
                    body: formData.get('descripcion'),
                    userId: 1 // ID de usuario ficticio
                };

                // Obtener la lista de anuncios existentes del almacenamiento local
                var anunciosGuardados = JSON.parse(localStorage.getItem('anuncios')) || [];

                // Agregar el nuevo anuncio a la lista
                anunciosGuardados.push(nuevoAnuncio);

                // Guardar la lista actualizada en el almacenamiento local
                localStorage.setItem('anuncios', JSON.stringify(anunciosGuardados));

                // Publicación del anuncio y mostrarlo en la sección 'Mis Anuncios'
                var nuevoAnuncioHTML =
                    '<div class="anuncio">' +
                    '<a href="#">' +
                    '<h3>' + formData.get('titulo') + '</h3>' +
                    '<p>' + formData.get('descripcion') + '</p>' +
                    '<p>' + formData.get('precio') + '€' + '</p>' +
                    '<button class="eliminar-anuncio">Eliminar anuncio</button>' +
                    '</a>' +
                    '<button class="boton" type="submit" id="btnEscribirrMensaje">Escribir mensaje</button>' +
                    '</div>';
                $("#misAnuncios").append(nuevoAnuncioHTML);

                // Limpiar el formulario
                $(this)[0].reset();

                // Ocultar el formulario después de enviarlo
                $(".nuevo-anuncio-container").hide();

                // Ocultar el mensaje 'No hay ningún anuncio publicado' cuando se publica un anuncio nuevo
                $("#nohayanuncios").hide();
            });

            // Agregar evento de clic para eliminar el anuncio
            $("#misAnuncios").on("click", ".eliminar-anuncio", function() {
                var anuncio = $(this).closest(".anuncio");
                var titulo = anuncio.find("h3").text();
                var descripcion = anuncio.find("p").first().text();

                eliminarAnuncio(titulo, descripcion);

                // Eliminar el anuncio del DOM
                anuncio.remove();
            });

            // Función para eliminar un anuncio del almacenamiento local
            function eliminarAnuncio(titulo, descripcion) {
                var anunciosGuardados = JSON.parse(localStorage.getItem('anuncios')) || [];
                var nuevosAnuncios = anunciosGuardados.filter(function(anuncio) {
                    return anuncio.title !== titulo || anuncio.body !== descripcion;
                });
                localStorage.setItem('anuncios', JSON.stringify(nuevosAnuncios));
            }
        });
            
    </script>
    
    <!-- Script para cargar mensajes en 'mi perfil' -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        $(document).ready(function() {
            // Botón "Escribir Mensaje" abre el formulario del nuevo mensaje
            $("#btnEscribirMensaje").click(function() {
                // Mostrar u ocultar el formulario para crear un nuevo anuncio
                $(".formulario-mensaje").toggle();
            });
            // Manejar el envío del mensaje
            $("#formularioMensaje").submit(function(event) {
                event.preventDefault(); // Evitar que se recargue la página

                // Obtener los datos del formulario
                var formData = new FormData(this);

                // Crear un objeto con los datos del anuncio
                var nuevoMensaje = {
                    body: formData.get('texto'),
                    userId: 1 // ID de usuario ficticio
                };

                // Obtener la lista de anuncios existentes del almacenamiento local
                var anunciosGuardados = JSON.parse(localStorage.getItem('mensajes')) || [];

                // Agregar el nuevo anuncio a la lista
                mensajesGuardados.push(nuevoMensaje);

                // Guardar la lista actualizada en el almacenamiento local
                localStorage.setItem('mensajes', JSON.stringify(mensajesGuardados));

                // Publicación del mensaje y mostrarlo en la sección 'Mis Mensajes'
                var nuevoAnuncioHTML =
                    '<div class="anuncio">' +
                    '<a href="#">' +
                    '<h3>' + formData.get('titulo') + '</h3>' +
                    '<p>' + formData.get('descripcion') + '</p>' +
                    '<p>' + formData.get('precio') + '€' + '</p>' +
                    '<button class="eliminar-anuncio">Eliminar anuncio</button>' +
                    '</a>' +
                    '<button class="boton" type="submit" id="btnEscribirrMensaje">Escribir mensaje</button>' +
                    '</div>';
                $("#misAnuncios").append(nuevoAnuncioHTML);
            });
        });
    </script>
</body>
</html>
